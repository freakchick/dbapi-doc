<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>安装教程 | DBAPI</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script>
          var _hmt = _hmt || [];
          (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?a8fb326da5bdf70aa80eb56b11f97e0f";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
          })();
                
          </script>
    <meta name="description" content="Vue-powered Static Site Generator">
    
    <link rel="preload" href="/dbapi-doc/assets/css/0.styles.86642878.css" as="style"><link rel="preload" href="/dbapi-doc/assets/js/app.c45c97b0.js" as="script"><link rel="preload" href="/dbapi-doc/assets/js/3.91e00d9f.js" as="script"><link rel="preload" href="/dbapi-doc/assets/js/10.60af250e.js" as="script"><link rel="prefetch" href="/dbapi-doc/assets/js/11.f19c60e4.js"><link rel="prefetch" href="/dbapi-doc/assets/js/12.883416c4.js"><link rel="prefetch" href="/dbapi-doc/assets/js/13.2c9b206a.js"><link rel="prefetch" href="/dbapi-doc/assets/js/14.7e1ef3ba.js"><link rel="prefetch" href="/dbapi-doc/assets/js/15.b6b16a19.js"><link rel="prefetch" href="/dbapi-doc/assets/js/4.48475e6c.js"><link rel="prefetch" href="/dbapi-doc/assets/js/5.7487c1a0.js"><link rel="prefetch" href="/dbapi-doc/assets/js/6.ac85b528.js"><link rel="prefetch" href="/dbapi-doc/assets/js/7.3e46598f.js"><link rel="prefetch" href="/dbapi-doc/assets/js/8.c9600528.js"><link rel="prefetch" href="/dbapi-doc/assets/js/9.ee2a264a.js"><link rel="prefetch" href="/dbapi-doc/assets/js/vendors~docsearch.5f89cefe.js">
    <link rel="stylesheet" href="/dbapi-doc/assets/css/0.styles.86642878.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/dbapi-doc/" class="home-link router-link-active"><!----> <span class="site-name">DBAPI</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/dbapi-doc/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/dbapi-doc/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/dbapi-doc/install/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Install
</a></div><div class="nav-item"><a href="/dbapi-doc/plugin/" class="nav-link">
  Plugin
</a></div><div class="nav-item"><a href="https://gitee.com/freakchicken/db-api" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/freakchick/DBApi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dbapi-doc/install/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/dbapi-doc/zh/install/" class="nav-link">
  简体中文
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/dbapi-doc/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/dbapi-doc/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/dbapi-doc/install/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Install
</a></div><div class="nav-item"><a href="/dbapi-doc/plugin/" class="nav-link">
  Plugin
</a></div><div class="nav-item"><a href="https://gitee.com/freakchicken/db-api" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/freakchick/DBApi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dbapi-doc/install/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/dbapi-doc/zh/install/" class="nav-link">
  简体中文
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>安装教程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dbapi-doc/install/#前言" class="sidebar-link">前言</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/dbapi-doc/install/#本地部署单机版" class="sidebar-link">本地部署单机版</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/dbapi-doc/install/#本地部署集群版" class="sidebar-link">本地部署集群版</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/dbapi-doc/install/#docker部署单机版" class="sidebar-link">docker部署单机版</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/dbapi-doc/install/#docker部署集群版" class="sidebar-link">docker部署集群版</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dbapi-doc/install/#启动ui服务manager" class="sidebar-link">启动UI服务manager</a></li><li class="sidebar-sub-header"><a href="/dbapi-doc/install/#启动网关服务-gateway" class="sidebar-link">启动网关服务 gateway</a></li><li class="sidebar-sub-header"><a href="/dbapi-doc/install/#启动api服务apiserver-此服务可启动多个-构建api集群" class="sidebar-link">启动API服务apiServer（此服务可启动多个，构建api集群）</a></li></ul></li><li><a href="/dbapi-doc/install/#附录" class="sidebar-link">附录</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dbapi-doc/install/#环境变量" class="sidebar-link">环境变量</a></li><li class="sidebar-sub-header"><a href="/dbapi-doc/install/#docker快速安装nacos" class="sidebar-link">docker快速安装nacos</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="安装教程"><a href="#安装教程" class="header-anchor">#</a> 安装教程</h1> <blockquote><p>安装包<a href="http://www.51dbapi.com/" target="_blank" rel="noopener noreferrer">下载地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ，或者在<a href="https://cloud.189.cn/t/Jza2MzeEZVNv" target="_blank" rel="noopener noreferrer">网盘<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 下载。</p></blockquote> <blockquote><p>默认账户admin/admin</p></blockquote> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <blockquote><p>为了便于您理解安装的时候需要配置的参数，请您先学习日志监控相关的功能设计</p></blockquote> <ul><li><p>DBAPI只依赖元数据库（mysql/sqlite）就可以使用，但是如果您还需要使用页面上的监控功能（监控API调用记录、访问量、成功率等等），
就必须依赖于另一个日志数据库（需用户自行搭建），来存储API访问日志，推荐使用clickhouse，当然您也可以使用其它的关系型数据库。</p></li> <li><p>API访问日志采集进入日志数据库有3种方式</p></li></ul> <ol><li>如果在<code>conf/application.properties</code>文件配置了<code>access.log.writer=db</code>，那么DBAPI会将API访问日志直接写入日志数据库，这种方式会直连日志数据库，适用于日志量不太大的场景下。</li> <li>如果在<code>conf/application.properties</code>文件配置了<code>access.log.writer=kafka</code>，那么DBAPI会将API访问日志写入kafka，
用户需要自行从kafka采集日志到日志数据库，这种方式适用于日志量大的场景，可以由kafka去做数据缓冲。</li></ol> <blockquote><p>同时DBAPI也自带了消费kafka日志并写入日志数据库的工具，请使用<code>bin/log-kafka2db.sh</code>脚本。</p></blockquote> <ol start="3"><li>DBAPI默认会将API访问日志写入磁盘文件<code>logs/dbapi-access.log</code>，用户可以自行使用<code>datax</code> <code>flume</code>等工具采集日志到日志数据库。此情况下需要配置<code>access.log.writer=null</code></li></ol> <ul><li>如果您不需要使用监控功能，可以不用搭建日志数据库，并配置<code>access.log.writer=null</code>即可。</li></ul> <h2 id="本地部署单机版"><a href="#本地部署单机版" class="header-anchor">#</a> 本地部署单机版</h2> <ul><li>依赖java环境，先自行在服务器安装<code>jdk8+</code>，并配置环境变量</li> <li>下载安装包解压到需要安装的目录</li> <li>修改<code>conf/application.properties</code>文件中的以下配置</li></ul> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token comment"># api访问路径的统一根路径，example: http://192.168.xx.xx:8520/api/xxx</span>
<span class="token comment"># api context</span>
<span class="token key attr-name">dbapi.api.context</span><span class="token punctuation">=</span><span class="token value attr-value">api</span>

<span class="token comment"># 如果不修改数据库地址将默认使用自带的内嵌元数据库sqlite</span>
<span class="token comment"># 元数据库地址，可以使用mysql或者自带的sqlite</span>
<span class="token key attr-name">spring.datasource.dynamic.datasource.meta-db.driver-class-name</span><span class="token punctuation">=</span><span class="token value attr-value">org.sqlite.JDBC</span>
<span class="token key attr-name">spring.datasource.dynamic.datasource.meta-db.url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:sqlite::resource:sqlite.db</span>
<span class="token key attr-name">spring.datasource.dynamic.datasource.meta-db.username</span><span class="token punctuation">=</span>
<span class="token key attr-name">spring.datasource.dynamic.datasource.meta-db.password</span><span class="token punctuation">=</span>

<span class="token comment"># 将API访问日志写入日志数据库（推荐clickhouse）的方式，值只能是db/kafka/null</span>
<span class="token comment"># db代表dbapi直连日志数据库，直接将API访问日志写入日志数据库</span>
<span class="token comment"># kafka代表dbapi将API访问日志写入kafka，用户需要自行从kafka收集日志写入日志数据库</span>
<span class="token comment"># null代表dbapi只会将API访问日志写入本地磁盘文件（logs/dbapi-access.log），用户需要自行从磁盘文件收集日志写入日志数据库</span>
<span class="token key attr-name">access.log.writer</span><span class="token punctuation">=</span><span class="token value attr-value">null</span>

<span class="token comment"># 日志数据库地址，推荐使用clickhouse，如果您不需要使用页面上的监控功能，可以不配置日志数据库地址</span>
<span class="token key attr-name">spring.datasource.dynamic.datasource.access-log-db.driver-class-name</span><span class="token punctuation">=</span><span class="token value attr-value">ru.yandex.clickhouse.ClickHouseDriver</span>
<span class="token key attr-name">spring.datasource.dynamic.datasource.access-log-db.url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:clickhouse://127.0.0.1:8123/default</span>
<span class="token key attr-name">spring.datasource.dynamic.datasource.access-log-db.username</span><span class="token punctuation">=</span><span class="token value attr-value">default</span>
<span class="token key attr-name">spring.datasource.dynamic.datasource.access-log-db.password</span><span class="token punctuation">=</span><span class="token value attr-value">123456</span>

<span class="token comment"># 如果配置了access.log.writer=kafka，那么还需要配置kafka地址和日志写入的topic</span>
<span class="token key attr-name">access.log.kafka.topic</span><span class="token punctuation">=</span><span class="token value attr-value">dbapi_access_log</span>
<span class="token key attr-name">spring.kafka.bootstrap-servers</span><span class="token punctuation">=</span><span class="token value attr-value">127.0.0.1:9092</span>

</code></pre></div><blockquote><p>如果配置了mysql作为元数据库，请先在mysql执行初始化脚本<code>sql/ddl_mysql.sql</code>
如果配置了日志数据库地址，请先在日志数据库执行初始化脚本<code>sql/access_log_clickhouse.sql</code></p></blockquote> <ul><li>Linux一键启停</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">sh</span> bin/dbapi-daemon.sh start standalone
<span class="token function">sh</span> bin/dbapi-daemon.sh stop standalone
</code></pre></div><ul><li>如果是windows操作系统请右键点击<code>bin/dbapi.ps1</code>文件，选择使用PowerShell运行</li></ul> <blockquote><p>注意windows系统只支持standalone模式运行，不支持集群模式</p></blockquote> <ul><li>浏览器访问<code>http://192.168.xx.xx:8520</code>进入UI</li></ul> <h2 id="本地部署集群版"><a href="#本地部署集群版" class="header-anchor">#</a> 本地部署集群版</h2> <ul><li>集群部署依赖<code>nacos</code>、<code>mysql</code>、<code>redis</code>，请先自行安装<code>nacos</code>（推荐1.4.2版本）、<code>mysql</code>、<code>redis</code></li> <li>准备多台机器，每台安装<code>jdk8+</code>并配置java环境变量</li> <li>选一台机器host1作为部署机，配置host1到其他每台机器的ssh免密登录</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>ssh-keygen <span class="token parameter variable">-t</span> rsa <span class="token parameter variable">-P</span> <span class="token string">''</span> <span class="token parameter variable">-f</span> ~/.ssh/id_rsa
<span class="token function">cat</span> ~/.ssh/id_rsa.pub <span class="token operator">&gt;&gt;</span> ~/.ssh/authorized_keys
<span class="token function">chmod</span> <span class="token number">600</span> ~/.ssh/authorized_keys

<span class="token keyword">for</span> <span class="token for-or-select variable">ip</span> <span class="token keyword">in</span> host2 host3<span class="token punctuation">;</span>     <span class="token comment"># 请将此处 host2 host3 替换为自己要部署的机器的 hostname</span>
<span class="token keyword">do</span>
  ssh-copy-id  <span class="token variable">$ip</span>   <span class="token comment"># 该操作执行过程中需要手动输入部署用户的密码</span>
<span class="token keyword">done</span>
</code></pre></div><ul><li><p>下载安装包并解压到部署机host1需要安装的目录</p></li> <li><p>在mysql创建新的数据库，并执行初始化脚本<code>sql/ddl_mysql.sql</code></p></li> <li><p>修改<code>conf/application.properties</code>文件中的以下配置</p></li></ul> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token comment">#################################### please config properties below #####################################</span>
<span class="token comment"># api访问路径的统一根路径，example: http://192.168.xx.xx:8520/api/xxx</span>
<span class="token comment"># api context</span>
<span class="token key attr-name">dbapi.api.context</span><span class="token punctuation">=</span><span class="token value attr-value">api</span>

<span class="token comment"># 元数据库地址，集群版只能使用mysql</span>
<span class="token key attr-name">spring.datasource.dynamic.datasource.meta-db.driver-class-name</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.cj.jdbc.Driver</span>
<span class="token key attr-name">spring.datasource.dynamic.datasource.meta-db.url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://127.0.0.1:3306/dbapi?useSSL=false&amp;characterEncoding=UTF-8&amp;serverTimezone=GMT%2B8</span>
<span class="token key attr-name">spring.datasource.dynamic.datasource.meta-db.username</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>
<span class="token key attr-name">spring.datasource.dynamic.datasource.meta-db.password</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>

<span class="token comment"># 将API访问日志写入日志数据库（推荐clickhouse）的方式，值只能是db/kafka/null</span>
<span class="token comment"># db代表dbapi直连日志数据库，直接将API访问日志写入日志数据库</span>
<span class="token comment"># kafka代表dbapi将API访问日志写入kafka，用户需要自行从kafka收集日志写入日志数据库</span>
<span class="token comment"># null代表dbapi只会将API访问日志写入本地磁盘文件（logs/dbapi-access.log），用户需要自行从磁盘文件收集日志写入日志数据库</span>
<span class="token key attr-name">access.log.writer</span><span class="token punctuation">=</span><span class="token value attr-value">null</span>

<span class="token comment"># 日志数据库地址，推荐使用clickhouse，如果您不需要使用页面上的监控功能，可以不配置日志数据库地址</span>
<span class="token key attr-name">spring.datasource.dynamic.datasource.access-log-db.driver-class-name</span><span class="token punctuation">=</span><span class="token value attr-value">ru.yandex.clickhouse.ClickHouseDriver</span>
<span class="token key attr-name">spring.datasource.dynamic.datasource.access-log-db.url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:clickhouse://127.0.0.1:8123/default</span>
<span class="token key attr-name">spring.datasource.dynamic.datasource.access-log-db.username</span><span class="token punctuation">=</span><span class="token value attr-value">default</span>
<span class="token key attr-name">spring.datasource.dynamic.datasource.access-log-db.password</span><span class="token punctuation">=</span><span class="token value attr-value">123456</span>

<span class="token comment"># 如果配置了access.log.writer=kafka，那么还需要配置kafka地址和日志写入的topic</span>
<span class="token key attr-name">access.log.kafka.topic</span><span class="token punctuation">=</span><span class="token value attr-value">dbapi_access_log</span>
<span class="token key attr-name">spring.kafka.bootstrap-servers</span><span class="token punctuation">=</span><span class="token value attr-value">127.0.0.1:9092</span>

<span class="token comment">############################## if cluster, please config properties below ##############################</span>

<span class="token comment"># nacos address, needed if cluster mode</span>
<span class="token key attr-name">spring.cloud.nacos.server-addr</span><span class="token punctuation">=</span><span class="token value attr-value">127.0.0.1:8848</span>
<span class="token key attr-name">spring.cloud.nacos.discovery.username</span><span class="token punctuation">=</span><span class="token value attr-value">nacos</span>
<span class="token key attr-name">spring.cloud.nacos.discovery.password</span><span class="token punctuation">=</span><span class="token value attr-value">nacos</span>
<span class="token key attr-name">spring.cloud.nacos.discovery.namespace</span><span class="token punctuation">=</span><span class="token value attr-value">public</span>

<span class="token comment"># redis address, needed if cluster mode</span>
<span class="token key attr-name">spring.redis.host</span><span class="token punctuation">=</span><span class="token value attr-value">localhost</span>
<span class="token key attr-name">spring.redis.port</span><span class="token punctuation">=</span><span class="token value attr-value">6379</span>
<span class="token key attr-name">spring.redis.database</span><span class="token punctuation">=</span><span class="token value attr-value">0</span>
<span class="token key attr-name">spring.redis.password</span><span class="token punctuation">=</span>

</code></pre></div><blockquote><p>如果配置了日志数据库地址，请先在日志数据库执行初始化脚本<code>sql/access_log_clickhouse.sql</code></p></blockquote> <ul><li>修改<code>conf/install_config.conf</code>文件，配置要安装的机器节点</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 所有要安装DBApi的主机ip或hostname，用逗号分隔</span>
<span class="token assign-left variable">ips</span><span class="token operator">=</span>host1,host2,host3

<span class="token assign-left variable">sshPort</span><span class="token operator">=</span><span class="token number">22</span>

<span class="token comment"># 要安装gateway的主机</span>
<span class="token assign-left variable">gateway</span><span class="token operator">=</span>host1

<span class="token comment"># 要安装apiServer的主机，多个用逗号分隔</span>
<span class="token assign-left variable">apiServers</span><span class="token operator">=</span>host1,host2,host3

<span class="token comment"># 要安装manager的主机</span>
<span class="token assign-left variable">manager</span><span class="token operator">=</span>host2
</code></pre></div><ul><li>拷贝host1中的安装文件到其他每台机器的<strong>相同目录</strong>，可使用脚本一键拷贝</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">sh</span> bin/scp-host.sh
</code></pre></div><ul><li>集群操作脚本</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 一键启动集群</span>
<span class="token function">sh</span> bin/start-all.sh

<span class="token comment"># 一键停止集群</span>
<span class="token function">sh</span> bin/stop-all.sh

<span class="token comment"># 手动启停单个服务</span>
<span class="token function">sh</span> bin/dbapi-daemon.sh start gateway
<span class="token function">sh</span> bin/dbapi-daemon.sh start manager
<span class="token function">sh</span> bin/dbapi-daemon.sh start apiServer

<span class="token function">sh</span> bin/dbapi-daemon.sh stop gateway
<span class="token function">sh</span> bin/dbapi-daemon.sh stop manager
<span class="token function">sh</span> bin/dbapi-daemon.sh stop apiServer

</code></pre></div><ul><li>浏览器访问<code>http://192.168.xx.xx:8523</code>进入UI; API通过gateway来访问<code>http://192.168.xx.xx:8525/api/xx</code></li></ul> <h2 id="docker部署单机版"><a href="#docker部署单机版" class="header-anchor">#</a> docker部署单机版</h2> <blockquote><p>建议先阅读此文档前面本地安装部分，便于理解docker每个环境变量的含义，理解启动的时候是否需要配置相应的环境变量</p></blockquote> <blockquote><p>Docker 容器通过环境变量进行配置，附录-环境变量列出了 <code>DBApi</code> 的可配置环境变量及其默认值</p></blockquote> <ul><li>一键启动（使用dbapi自带的元数据库sqlite，且不能使用日志监控功能）</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">-p</span> <span class="token number">8520</span>:8520 <span class="token parameter variable">--name</span> dbapi freakchicken/db-api:3.2.0 standalone
</code></pre></div><ul><li>如果需要使用监控功能，还要配置日志数据库地址，以及将日志写入日志数据库</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">8520</span>:8520 <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">ACCESS_LOG_WRITER</span><span class="token operator">=</span><span class="token string">&quot;db&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">LOG_DB_URL</span><span class="token operator">=</span><span class="token string">&quot;jdbc:clickhouse://127.0.0.1:8123/default&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">LOG_DB_USERNAME</span><span class="token operator">=</span><span class="token string">&quot;default&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">LOG_DB_PASSWORD</span><span class="token operator">=</span><span class="token string">&quot;123456&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">LOG_DB_DRIVER</span><span class="token operator">=</span><span class="token string">&quot;ru.yandex.clickhouse.ClickHouseDriver&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> dbapi <span class="token punctuation">\</span>
freakchicken/db-api:3.2.0 standalone
</code></pre></div><ul><li>如果使用自己的mysql作为元数据库（启动前需要在mysql执行初始化脚本）</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">8520</span>:8520 <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">DB_URL</span><span class="token operator">=</span><span class="token string">&quot;jdbc:mysql://192.168.xx.xx:3306/dbapi?useSSL=false&amp;characterEncoding=UTF-8&amp;serverTimezone=GMT%2B8&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">DB_USERNAME</span><span class="token operator">=</span><span class="token string">&quot;root&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">DB_PASSWORD</span><span class="token operator">=</span><span class="token string">&quot;root&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">DB_DRIVER</span><span class="token operator">=</span><span class="token string">&quot;com.mysql.cj.jdbc.Driver&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">ACCESS_LOG_WRITER</span><span class="token operator">=</span><span class="token string">&quot;db&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">LOG_DB_URL</span><span class="token operator">=</span><span class="token string">&quot;jdbc:clickhouse://127.0.0.1:8123/default&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">LOG_DB_USERNAME</span><span class="token operator">=</span><span class="token string">&quot;default&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">LOG_DB_PASSWORD</span><span class="token operator">=</span><span class="token string">&quot;123456&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">LOG_DB_DRIVER</span><span class="token operator">=</span><span class="token string">&quot;ru.yandex.clickhouse.ClickHouseDriver&quot;</span> <span class="token punctuation">\</span>
freakchicken/db-api:3.2.0 standalone
</code></pre></div><ul><li>如果需要将API访问日志写入kafka，还需要配置kafka相关配置</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">8520</span>:8520 <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">DB_URL</span><span class="token operator">=</span><span class="token string">&quot;jdbc:mysql://192.168.xx.xx:3306/dbapi?useSSL=false&amp;characterEncoding=UTF-8&amp;serverTimezone=GMT%2B8&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">DB_USERNAME</span><span class="token operator">=</span><span class="token string">&quot;root&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">DB_PASSWORD</span><span class="token operator">=</span><span class="token string">&quot;root&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">DB_DRIVER</span><span class="token operator">=</span><span class="token string">&quot;com.mysql.cj.jdbc.Driver&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">ACCESS_LOG_WRITER</span><span class="token operator">=</span><span class="token string">&quot;kafka&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">ACCESS_LOG_KAFKA_TOPIC</span><span class="token operator">=</span><span class="token string">&quot;dbapi_access_log&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">ACCESS_LOG_KAFKA</span><span class="token operator">=</span><span class="token string">&quot;127.0.0.1:9092&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">LOG_DB_URL</span><span class="token operator">=</span><span class="token string">&quot;jdbc:clickhouse://127.0.0.1:8123/default&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">LOG_DB_USERNAME</span><span class="token operator">=</span><span class="token string">&quot;default&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">LOG_DB_PASSWORD</span><span class="token operator">=</span><span class="token string">&quot;123456&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">LOG_DB_DRIVER</span><span class="token operator">=</span><span class="token string">&quot;ru.yandex.clickhouse.ClickHouseDriver&quot;</span> <span class="token punctuation">\</span>
freakchicken/db-api:3.2.0 standalone
</code></pre></div><ul><li>浏览器访问<code>http://192.168.xx.xx:8520</code>进入UI</li></ul> <h2 id="docker部署集群版"><a href="#docker部署集群版" class="header-anchor">#</a> docker部署集群版</h2> <blockquote><p>建议先阅读此文档前面本地安装部分，便于理解docker每个环境变量的含义，理解启动的时候是否需要配置相应的环境变量</p></blockquote> <blockquote><p>Docker 容器通过环境变量进行配置，附录-环境变量 列出了 <code>DBApi</code> 的可配置环境变量及其默认值</p></blockquote> <ul><li>集群部署依赖<code>nacos</code>、<code>mysql</code>、<code>redis</code>，请先自行安装<code>nacos</code>（推荐1.4.2版本）、<code>mysql</code>、<code>redis</code></li> <li>在mysql创建新的数据库，执行数据库初始化脚本（下载安装包解压获取<code>sql/ddl_mysql.sql</code>脚本）</li></ul> <h3 id="启动ui服务manager"><a href="#启动ui服务manager" class="header-anchor">#</a> 启动UI服务manager</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">8523</span>:8523 <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">DB_URL</span><span class="token operator">=</span><span class="token string">&quot;jdbc:mysql://192.168.xx.xx:3306/dbapi?useSSL=false&amp;characterEncoding=UTF-8&amp;serverTimezone=GMT%2B8&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">DB_USERNAME</span><span class="token operator">=</span><span class="token string">&quot;root&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">DB_PASSWORD</span><span class="token operator">=</span><span class="token string">&quot;root&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">DB_DRIVER</span><span class="token operator">=</span><span class="token string">&quot;com.mysql.cj.jdbc.Driver&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">NACOS_ADDRESS</span><span class="token operator">=</span><span class="token string">&quot;192.168.xx.xx:8848&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">NACOS_USERNAME</span><span class="token operator">=</span><span class="token string">&quot;nacos&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">NACOS_PASSWORD</span><span class="token operator">=</span><span class="token string">&quot;nacos&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">NACOS_NAMESPACE</span><span class="token operator">=</span><span class="token string">&quot;public&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">REDIS_HOST</span><span class="token operator">=</span><span class="token string">&quot;127.0.0.1&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">REDIS_PORT</span><span class="token operator">=</span><span class="token number">6379</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">REDIS_DATABASE</span><span class="token operator">=</span><span class="token number">0</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">REDIS_PASSWORD</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">LOG_DB_URL</span><span class="token operator">=</span><span class="token string">&quot;jdbc:clickhouse://127.0.0.1:8123/default&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">LOG_DB_USERNAME</span><span class="token operator">=</span><span class="token string">&quot;default&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">LOG_DB_PASSWORD</span><span class="token operator">=</span><span class="token string">&quot;123456&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">LOG_DB_DRIVER</span><span class="token operator">=</span><span class="token string">&quot;ru.yandex.clickhouse.ClickHouseDriver&quot;</span> <span class="token punctuation">\</span>
freakchicken/db-api:3.2.0 manager
</code></pre></div><h3 id="启动网关服务-gateway"><a href="#启动网关服务-gateway" class="header-anchor">#</a> 启动网关服务 gateway</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">8525</span>:8525 <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">DB_URL</span><span class="token operator">=</span><span class="token string">&quot;jdbc:mysql://192.168.xx.xx:3306/dbapi?useSSL=false&amp;characterEncoding=UTF-8&amp;serverTimezone=GMT%2B8&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">DB_USERNAME</span><span class="token operator">=</span><span class="token string">&quot;root&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">DB_PASSWORD</span><span class="token operator">=</span><span class="token string">&quot;root&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">DB_DRIVER</span><span class="token operator">=</span><span class="token string">&quot;com.mysql.cj.jdbc.Driver&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">NACOS_ADDRESS</span><span class="token operator">=</span><span class="token string">&quot;192.168.xx.xx:8848&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">NACOS_USERNAME</span><span class="token operator">=</span><span class="token string">&quot;nacos&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">NACOS_PASSWORD</span><span class="token operator">=</span><span class="token string">&quot;nacos&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">NACOS_NAMESPACE</span><span class="token operator">=</span><span class="token string">&quot;public&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">REDIS_HOST</span><span class="token operator">=</span><span class="token string">&quot;127.0.0.1&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">REDIS_PORT</span><span class="token operator">=</span><span class="token number">6379</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">REDIS_DATABASE</span><span class="token operator">=</span><span class="token number">0</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">REDIS_PASSWORD</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span> <span class="token punctuation">\</span>
freakchicken/db-api:3.2.0 gateway
</code></pre></div><h3 id="启动api服务apiserver-此服务可启动多个-构建api集群"><a href="#启动api服务apiserver-此服务可启动多个-构建api集群" class="header-anchor">#</a> 启动API服务apiServer（此服务可启动多个，构建api集群）</h3> <ul><li>API访问日志直接写入日志数据库方式</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">DB_URL</span><span class="token operator">=</span><span class="token string">&quot;jdbc:mysql://192.168.xx.xx:3306/dbapi?useSSL=false&amp;characterEncoding=UTF-8&amp;serverTimezone=GMT%2B8&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">DB_USERNAME</span><span class="token operator">=</span><span class="token string">&quot;root&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">DB_PASSWORD</span><span class="token operator">=</span><span class="token string">&quot;root&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">DB_DRIVER</span><span class="token operator">=</span><span class="token string">&quot;com.mysql.cj.jdbc.Driver&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">NACOS_ADDRESS</span><span class="token operator">=</span><span class="token string">&quot;192.168.xx.xx:8848&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">NACOS_USERNAME</span><span class="token operator">=</span><span class="token string">&quot;nacos&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">NACOS_PASSWORD</span><span class="token operator">=</span><span class="token string">&quot;nacos&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">NACOS_NAMESPACE</span><span class="token operator">=</span><span class="token string">&quot;public&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">REDIS_HOST</span><span class="token operator">=</span><span class="token string">&quot;127.0.0.1&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">REDIS_PORT</span><span class="token operator">=</span><span class="token number">6379</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">REDIS_DATABASE</span><span class="token operator">=</span><span class="token number">0</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">REDIS_PASSWORD</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">ACCESS_LOG_WRITER</span><span class="token operator">=</span><span class="token string">&quot;db&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">LOG_DB_URL</span><span class="token operator">=</span><span class="token string">&quot;jdbc:clickhouse://127.0.0.1:8123/default&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">LOG_DB_USERNAME</span><span class="token operator">=</span><span class="token string">&quot;default&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">LOG_DB_PASSWORD</span><span class="token operator">=</span><span class="token string">&quot;123456&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">LOG_DB_DRIVER</span><span class="token operator">=</span><span class="token string">&quot;ru.yandex.clickhouse.ClickHouseDriver&quot;</span> <span class="token punctuation">\</span>
freakchicken/db-api:3.2.0 apiServer
</code></pre></div><ul><li>如果需要将API访问日志写入kafka，还需要配置kafka相关配置</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">DB_URL</span><span class="token operator">=</span><span class="token string">&quot;jdbc:mysql://192.168.xx.xx:3306/dbapi?useSSL=false&amp;characterEncoding=UTF-8&amp;serverTimezone=GMT%2B8&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">DB_USERNAME</span><span class="token operator">=</span><span class="token string">&quot;root&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">DB_PASSWORD</span><span class="token operator">=</span><span class="token string">&quot;root&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">DB_DRIVER</span><span class="token operator">=</span><span class="token string">&quot;com.mysql.cj.jdbc.Driver&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">NACOS_ADDRESS</span><span class="token operator">=</span><span class="token string">&quot;192.168.xx.xx:8848&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">NACOS_USERNAME</span><span class="token operator">=</span><span class="token string">&quot;nacos&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">NACOS_PASSWORD</span><span class="token operator">=</span><span class="token string">&quot;nacos&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">NACOS_NAMESPACE</span><span class="token operator">=</span><span class="token string">&quot;public&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">REDIS_HOST</span><span class="token operator">=</span><span class="token string">&quot;127.0.0.1&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">REDIS_PORT</span><span class="token operator">=</span><span class="token number">6379</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">REDIS_DATABASE</span><span class="token operator">=</span><span class="token number">0</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">REDIS_PASSWORD</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">ACCESS_LOG_WRITER</span><span class="token operator">=</span><span class="token string">&quot;kafka&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">ACCESS_LOG_KAFKA_TOPIC</span><span class="token operator">=</span><span class="token string">&quot;dbapi_access_log&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">ACCESS_LOG_KAFKA</span><span class="token operator">=</span><span class="token string">&quot;127.0.0.1:9092&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">LOG_DB_URL</span><span class="token operator">=</span><span class="token string">&quot;jdbc:clickhouse://127.0.0.1:8123/default&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">LOG_DB_USERNAME</span><span class="token operator">=</span><span class="token string">&quot;default&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">LOG_DB_PASSWORD</span><span class="token operator">=</span><span class="token string">&quot;123456&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">LOG_DB_DRIVER</span><span class="token operator">=</span><span class="token string">&quot;ru.yandex.clickhouse.ClickHouseDriver&quot;</span> <span class="token punctuation">\</span>
freakchicken/db-api:3.2.0 apiServer
</code></pre></div><ul><li>浏览器访问<code>http://192.168.xx.xx:8523</code>进入UI; API通过gateway来访问<code>http://192.168.xx.xx:8525/api/xx</code></li></ul> <h2 id="附录"><a href="#附录" class="header-anchor">#</a> 附录</h2> <h3 id="环境变量"><a href="#环境变量" class="header-anchor">#</a> 环境变量</h3> <blockquote><p>Docker部署的时候通过以下环境变量来传递参数</p></blockquote> <table><thead><tr><th>环境变量</th> <th>默认值</th> <th>说明</th></tr></thead> <tbody><tr><td>API_CONTEXT</td> <td>api</td> <td>所有API的统一根路径</td></tr> <tr><td>DB_URL</td> <td>jdbc:sqlite::resource:sqlite.db</td> <td>元数据库地址</td></tr> <tr><td>DB_USERNAME</td> <td></td> <td>元数据库账户</td></tr> <tr><td>DB_PASSWORD</td> <td></td> <td>元数据库密码</td></tr> <tr><td>DB_DRIVER</td> <td>org.sqlite.JDBC</td> <td>元数据库地址jdbc驱动</td></tr> <tr><td>NACOS_ADDRESS</td> <td>127.0.0.1:8848</td> <td>集群模式使用的nacos地址</td></tr> <tr><td>NACOS_USERNAME</td> <td>nacos</td> <td>集群模式使用的nacos账户</td></tr> <tr><td>NACOS_PASSWORD</td> <td>nacos</td> <td>集群模式使用的nacos密码</td></tr> <tr><td>NACOS_NAMESPACE</td> <td>public</td> <td>集群模式使用的nacos namespace</td></tr> <tr><td>REDIS_HOST</td> <td>127.0.0.1</td> <td>集群模式使用的redis地址</td></tr> <tr><td>REDIS_PORT</td> <td>6379</td> <td>集群模式使用的redis端口</td></tr> <tr><td>REDIS_DATABASE</td> <td>0</td> <td>集群模式使用的redis数据库号</td></tr> <tr><td>REDIS_PASSWORD</td> <td></td> <td>集群模式使用的redis密码</td></tr> <tr><td>LOG_DB_URL</td> <td>jdbc:clickhouse://127.0.0.1:8123/default</td> <td>日志数据库地址</td></tr> <tr><td>LOG_DB_USERNAME</td> <td>default</td> <td>日志数据库账户</td></tr> <tr><td>LOG_DB_PASSWORD</td> <td>123456</td> <td>日志数据库密码</td></tr> <tr><td>LOG_DB_DRIVER</td> <td>ru.yandex.clickhouse.ClickHouseDriver</td> <td>日志数据库地址jdbc驱动</td></tr> <tr><td>ACCESS_LOG_WRITER</td> <td>null</td> <td>API访问日志写入数据库的方式</td></tr> <tr><td>ACCESS_LOG_KAFKA_TOPIC</td> <td>dbapi_access_log</td> <td>API访问日志写入的Kafka的topic</td></tr> <tr><td>ACCESS_LOG_KAFKA</td> <td>127.0.0.1:9092</td> <td>API访问日志写入的Kafka的地址</td></tr></tbody></table> <h3 id="docker快速安装nacos"><a href="#docker快速安装nacos" class="header-anchor">#</a> docker快速安装nacos</h3> <div class="language- extra-class"><pre class="language-text"><code>docker run --env MODE=standalone --name nacos -d -p 8848:8848 nacos/nacos-server:1.4.2
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/dbapi-doc/assets/js/app.c45c97b0.js" defer></script><script src="/dbapi-doc/assets/js/3.91e00d9f.js" defer></script><script src="/dbapi-doc/assets/js/10.60af250e.js" defer></script>
  </body>
</html>
